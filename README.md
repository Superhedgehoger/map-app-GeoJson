# GeoJSON 地图编辑器 - 使用指南

[![Version](https://img.shields.io/badge/version-v2.4.0-blue.svg)](CHANGELOG.md)

> ⚠️ **隐私声明**：本项目不包含任何真实或测试业务数据，仅提供代码结构与功能实现。

## 🎉 新功能概览

现在你的地图应用已经升级为功能完整的 **GeoJSON 编辑器**，类似 geojson.io！

### 核心功能
1. ✅ **Leaflet.draw 绘图工具** - 圆形、矩形、多边形、折线、标记
2. ✅ **GeoJSON 导入/导出** - 完整格式支持
3. ✅ **Excel 导入/导出** - 支持 `.xlsx` 格式，包含所有字段（经纬度、名称、类型、地址、颜色、符号）
4. ✅ **Excel 模板下载** - 一键下载标准格式模板
5. ✅ **实时代码编辑器** - 可切换显示/隐藏
6. ✅ **图层管理面板** - 显示/隐藏/重命名/删除，新增 **显示/隐藏图层面板按钮**
7. ✅ **标记弹窗 (Popup)** - 点击标记弹出信息窗，显示名称、类型、地址并可复制经纬度
8. ✅ **标注名称显示** - 可开关的标签显示
9. ✅ **保留所有原功能** - 高德搜索、坐标拾取、CSV 导入导出

---

## 🚀 快速开始

### 1. 启动应用
```powershell
CD C:\Users\DJY\Documents\AnGoogle\map-app
python -m http.server 8000
```

浏览器访问：`http://localhost:8000/index.html`

### 2. 界面布局
```
[左侧控制面板] [中间地图+绘图工具] [右侧图层列表]
```

---

## 📐 绘图工具使用

### 绘制图形
地图左上角有 Leaflet.draw 工具栏：

| 图标 | 功能 | 操作 |
|------|------|------|
| 📍 | 标记 | 点击地图放置标记 |
| ✏️ | 折线 | 点击多个点，双击完成 |
| ⬛ | 多边形 | 点击多个点，双击完成 |
| ▭ | 矩形 | 拖动绘制矩形 |
| ⭕ | 圆形 | 点击中心，拖动设置半径 |

### 编辑图形
1. 点击工具栏的 **编辑** 按钮
2. 拖动图形的节点修改形状
3. 点击 **保存** 完成编辑

### 删除图形
1. 点击工具栏的 **删除** 按钮
2. 点击要删除的图形
3. 点击 **保存** 确认删除

---

## 📊 GeoJSON 功能

### 导出 GeoJSON
1. 点击左侧面板的 **"导出 GeoJSON"** 按钮
2. 自动下载 `map_data.geojson` 文件
3. 包含所有绘制的图形和属性

### 导入 GeoJSON
1. 点击 **"导入 GeoJSON"** 文件选择器
2. 选择 `.json` 或 `.geojson` 文件
3. 图形自动显示在地图上

### 代码编辑器
1. 点击 **"显示代码编辑器"** 按钮
2. 底部弹出编辑器，显示当前 GeoJSON 代码
3. 直接编辑代码
4. 点击 **"应用到地图"** 按钮更新地图
5. 点击 **"隐藏代码编辑器"** 关闭

---

## 🗂️ 图层管理

### 图层列表（右侧面板）
每个图层显示：
- **名称** - 可自定义
- **类型** - 标记/圆形/矩形/多边形/折线
- **操作按钮**

### 图层操作
| 按钮 | 功能 |
|------|------|
| 隐藏 | 临时隐藏图层（再次点击显示）|
| 重命名 | 修改图层名称 |
| 删除 | 永久删除图层 |

### 清空所有图层
点击图层面板底部的 **"清空所有图层"** 按钮（红色）

---

## 🏷️ 标注名称显示

### 开启/关闭标签
1. 在左侧面板找到 **"显示标注名称"** 复选框
2. 勾选后，所有图层的名称会显示在地图上
3. 取消勾选隐藏标签

### 自定义标签内容
1. 在图层列表中点击 **"重命名"**
2. 输入新名称
3. 标签自动更新

---

## 🔧 其他功能

### 坐标拾取
1. 点击 **"启用坐标拾取"**
2. 点击地图任意位置
3. 坐标显示在按钮下方并自动复制到剪贴板

### 手动添加标注
1. 在 **"输入备注信息"** 框输入备注
2. 点击 **"点击地图添加"**
3. 点击地图放置标记

### 搜索地址（需要高德 API Key）
1. 输入地址（如：天安门）
2. 点击 **"搜索"**
3. 地图跳转并添加标记

### 输入坐标定位
1. 输入纬度和经度
2. 点击 **"跳转到中心"**
3. 地图跳转到该坐标

### Excel 导入/导出（推荐）

#### 下载导入模板
1. 点击 **"下载 Excel 模板"** 按钮
2. 自动下载 `地图标记导入模板.xlsx`
3. 模板包含所有字段示例：
   - 经度 (Longitude)
   - 纬度 (Latitude)
   - 名称 (Name)
   - 类型 (Type)
   - 地址 (Address)
   - 标记颜色 (marker-color) - 十六进制颜色代码，如 `#4a90e2`
   - 标记符号 (marker-symbol) - 如 `shop`, `car`, `fuel` 等

#### 导入 Excel
1. 准备好 Excel 文件（`.xlsx` 或 `.xls`）
2. 确保包含 **经度** 和 **纬度** 列（支持中英文列名）
3. 点击 **"导入 Excel"** 选择文件
4. 自动识别所有字段并创建标记
5. 支持的列名格式：
   - 经度：`经度 (Longitude)`, `Longitude`, `lng`, `经度`
   - 纬度：`纬度 (Latitude)`, `Latitude`, `lat`, `纬度`
   - 其他字段同理

#### 导出 Excel（完整字段）
1. 点击 **"导出 Excel（完整字段）"** 按钮
2. 自动下载 `地图标记数据.xlsx`
3. 包含所有标记的完整信息：
   - 坐标（经纬度）
   - 名称、类型、地址
   - 标记颜色和符号
4. 可直接用于备份或再次导入

### CSV 导入/导出（简化版）

#### 导出 CSV（仅坐标）
- 点击 **"导出 CSV（仅坐标）"** - 仅导出经纬度
- 格式：`latitude,longitude`
- 适合快速导出坐标列表

#### 导入 CSV
- 点击 **"导入 CSV"** 选择文件
- 支持多种列名格式
- 自动识别名称、类型、地址等字段

---

## 💡 使用技巧

### 1. 快速绘制多个图形
- 绘制工具会保持激活状态
- 连续点击可绘制多个相同类型的图形
- 按 ESC 或点击工具栏退出绘制模式

### 2. 精确编辑
- 使用代码编辑器可以精确修改坐标
- 适合批量调整或微调位置

### 3. 数据备份
- 定期导出 GeoJSON 文件作为备份
- GeoJSON 格式通用，可在其他工具中使用

### 4. 图层组织
- 给图层起有意义的名称
- 使用隐藏功能临时关闭不需要的图层
- 保持图层列表整洁

---

## ⚙️ 配置高德 API Key（可选）

只有 **搜索地址** 和 **导入地址 CSV** 需要 API Key，其他功能都可正常使用。

1. 访问 https://lbs.amap.com/
2. 注册并创建 **Web 服务** Key
3. 打开 `script.js`，找到第 2 行：
   ```javascript
   const AMAP_API_KEY = 'YOUR_AMAP_API_KEY';
   ```
4. 替换为你的 Key：
   ```javascript
   const AMAP_API_KEY = '你的密钥';
   ```
5. 保存并刷新浏览器

---

## 🎨 界面说明

### 左侧控制面板
- 底图选择
- GeoJSON 导入/导出
- CSV 功能
- 工具功能
- 显示选项

### 中间地图区域
- 绘图工具栏（左上角）
- 地图交互区域
- 缩放控件（左下角）

### 右侧图层面板
- 图层列表
- 图层操作按钮
- 清空按钮

### 底部代码编辑器（可选）
- GeoJSON 代码显示
- 实时编辑
- 应用按钮

---

## 🐛 常见问题

**Q: 绘图工具栏不显示？**  
A: 确保已正确加载 Leaflet.draw 库，检查浏览器控制台是否有错误。

**Q: GeoJSON 导入失败？**  
A: 检查文件格式是否正确，必须是有效的 GeoJSON 格式。

**Q: 标签显示重叠？**  
A: 缩放地图或重命名图层使用更短的名称。

**Q: 代码编辑器修改后没有效果？**  
A: 确保点击了 **"应用到地图"** 按钮。

---

**享受你的 GeoJSON 地图编辑器！** 🗺️✨
