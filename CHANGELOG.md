# GeoJSON 地图编辑器 - 更新日志

本文档记录 GeoJSON 地图编辑器的所有版本更新，从新到旧排列。

---

## [v2.10.0] - 2026-01-17

### ✨ 新功能

#### 分发构建版本
- **单网页版** (`index-single.html`)：所有 JS/CSS 内联到一个 HTML 文件
- **便携版** (`/portable`)：独立目录结构，可拷贝即用或打包为桌面应用
- **构建脚本** (`build-single.py`)：自动合并生成单文件版本

#### API 挂接模块 (`portable/js/api-hooks.js`)
- `GeoMapAPI.loadGeoJSON()` / `saveGeoJSON()` - GeoJSON 数据操作
- `GeoMapAPI.listArchives()` / `loadArchive()` / `saveArchive()` - 存档管理
- `GeoMapAPI.listSnapshots()` / `saveSnapshot()` / `loadSnapshot()` - 快照管理
- `GeoMapAPI.loadUserConfig()` / `saveUserConfig()` - 用户配置
- `GeoMapAPI.geocodeAddress()` - 地理编码服务
- 当前使用 localStorage 实现，后续可替换为后端 API

### 📝 文档更新
- README.md 新增"构建与分发"章节

---

## [v2.9.2] - 2026-01-14

### 🐛 Bug 修复

#### 浏览模式核心功能修复
- **快照切换失败**：`_resetRuntimeState()` 中 `selectionManager.clear()` → `selectionManager.deselect()`
- **X 退出按钮无效**：同上，TypeError 导致函数执行中断
- **浏览模式 UI 重复**：移除 `_showBrowseModeOverlay()`，仅保留顶部操作条

#### 图层面板无法打开
- **问题**：事件监听器未正确绑定
- **修复**：在 HTML 中添加 `onclick="toggleLayerPanel()"`
- **新增 CSS**：`.layer-panel` 显示/隐藏样式

#### 浏览模式状态条优化
- **新设计**：居中悬浮小胶囊（非全宽横幅）
- **布局**：[✕ 退出] [👁️ 只读浏览] [快照名] [✓ 应用]
- **插入位置**：`document.body` 顶部固定定位

### 📦 代码同步
- 所有修复同步到 Geomap-app-lite

---

## [v2.9.1] - 2026-01-13

### 🐛 Bug 修复

#### 历史地图浏览模式退出修复
- **问题**：退出浏览模式后，编辑功能仍被禁用
- **修复**：
  - 增强 `_disableEditControls()` / `_enableEditControls()`
  - 添加 ESC 键退出监听
  - 添加全局 `exitHistoryBrowseModeSafe()` 函数
  - 切换 Accordion 时自动退出浏览模式

#### Leaflet.draw 工具栏定位修复
- **问题**：工具栏与左侧面板重叠
- **修复**：调整 `margin-left: 312px`，折叠状态 `88px`

### 📝 文档重构
- **CHANGELOG 统一**：根目录 CHANGELOG.md 为唯一权威日志
- **README 精简**：从 273 行精简到 ~70 行
- **updatedocs 整理**：CHANGELOG.md → ARCHIVE_CHANGELOG.md

---

## [v2.9.0] - 2026-01-13

### ✨ 新功能

#### 统一悬浮面板系统（Floating Panel System）
- **毛玻璃效果**：所有面板 `backdrop-filter: blur(14px)` + 半透明背景
- **统一基类**：`.floating-panel` 基类定义圆角、阴影、边框
- **CSS 变量**：`--bg-glass`、`--border-glass`、`--shadow-float` 等统一管理

#### 左侧 Dock 折叠模式
- **图标模式**：折叠后显示 5 个图标（搜索/导入/图层/历史/工具）
- **Tooltip**：悬停显示功能名称
- **一键展开**：点击图标展开对应功能模块

#### 图层管理面板升级
- **固定头部**：标题 + 关闭按钮固定在顶部
- **搜索栏**：实时过滤图层列表
- **可折叠分组**：图层列表/图层详情/统计汇总 可独立折叠
- **滚动列表**：`max-height: 40vh` + `overflow-y: auto`

### 🐛 Bug 修复
- **地图不显示**：修复 UI 重构后 `#map` 被嵌套在隐藏元素内的问题
- **Dock 图标不可见**：添加 `.dock-icon i` 显式样式
- **Leaflet.draw 图标不可见**：改用 `background-color:` 保留 sprite 图标

### 🎨 UI 优化
- **缩放控件**：移至左下角，44×44px 点击区域
- **自定义滚动条**：6px 宽度，透明轨道
- **按钮系统**：主按钮 `#1677FF`、次按钮描边、文字按钮

---

## [v2.8.0] - 2026-01-13

### ✨ 新功能

#### 快照浏览模式
- **进入浏览**：点击历史地图模块的 👁️ 按钮
- **快照切换**：浏览模式下点击快照列表项立即加载
- **状态隔离**：进入时保存编辑态，退出时自动恢复
- **禁用编辑**：浏览模式下绘制控件/导入/清空按钮禁用

#### 表格定位按钮
- **新增列**：表格末尾添加「定位」按钮列
- **按钮点击**：flyTo + 高亮 + 展开同坐标组

#### 图层搜索功能
- **搜索栏**：图层详情面板顶部添加搜索输入框
- **模糊匹配**：按名称/类型/地址匹配

### 🐛 Bug 修复
- **GeoJSON 导入「替换」模式**：每个清理步骤独立 try/catch，方法调用前检查
- **快照数据隔离**：加载快照前调用 `_resetRuntimeState()`

---

## [v2.7.1] - 2026-01-12
- ✅ 「地图历史」→「历史地图」名称统一
- ✅ 保存按钮颜色统一为蓝色
- ✅ 工具菜单改为横排显示
- ✅ 左侧面板收起时隐藏历史地图模块

---

## [v2.7.0] - 2026-01-12
- ✨ 「历史地图」模块（原时间轴），默认收起
- ✨ 右下角工具入口合并（表格 + 看板 → 统一工具菜单）
- ✅ 移除异常浮动图标

---

## [v2.6.0] - 2026-01-12

### ✨ 新功能

#### 时间轴快照系统
- **快照保存**：保存当前地图完整状态（标记样式、视图状态、自定义组）
- **快照加载**：点击时间点恢复该状态
- **快照管理**：重命名、删除
- **localStorage 持久化**

#### 看板统计面板
- 当前时间点名称、总标记数
- 按类型分组统计
- 颜色色块预览 + 图标预览
- 实时刷新

---

## [v2.5.1] - 2026-01-12
- ✅ CSS Grid 布局重构（左侧面板与底部表格联动）
- ✅ 表格展开时面板高度自动缩短
- ✅ 平滑过渡动画 + 地图自动重绘

---

## [v2.5.0] - 2026-01-12
- ✨ **自定义组管理器**（多选标记创建命名组）
- ✅ 组 CRUD 操作 + localStorage 持久化
- ✅ 组导出 GeoJSON
- ✅ 多选模式高亮显示

---

## [v2.4.0] - 2026-01-09
- ✨ 图层统计功能（按类型分组 + 全局汇总）
- ✨ 四向联动（Table/地图/图层面板/属性编辑器）
- ✨ SelectionManager 统一选中状态管理

---

## [v2.3.0] - 2026-01-09
- ✨ 组合标记功能（同坐标合并 + 数量徽标）
- ✨ 放射展开 Spiderfy（圆形/螺旋布局）
- ✅ ESC/空白点击收起
- ✅ 数据完整性保障（不修改原始坐标）

---

## [v2.2.1] - 2026-01-09
- ✅ 中文字段全平台支持（弹窗、编辑器、表格动态列）
- ✅ "添加/管理事件"按钮功能修复与统一
- ✅ 标记点击交互优化（弹窗与高亮并存）

---

## [v2.2.0] - 2026-01-09
- ✅ 中文字段完整支持
- ✅ 右键属性编辑器修复
- ✅ 左键事件功能增强（双击打开事件追踪器）

---

## [v2.1.0] - 2026-01-08
- ✅ 表格视图面板（Tabulator）
- ✅ 虚拟滚动、单元格编辑
- ✅ 双向联动

---

## [v2.0.0] - 2026-01-08
- ✅ 侧边抽屉属性编辑器
- ✅ 交互系统重构
- ✅ 同位置多标记支持

---

## [v1.2.0] - 2026-01-08
- ✅ 智能端口检测（8000-8099）
- ✅ 新增 `server.py`

---

## [v1.0.0] - 基础版本
- ✨ 地图编辑（标记、线条、多边形）
- ✨ 自定义图标与颜色
- ✨ GeoJSON 导入/导出
- ✨ 事件追踪器
- ✨ 无限命名存档
- ✨ 多种底图切换
